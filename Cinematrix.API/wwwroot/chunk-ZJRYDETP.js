import{Aa as l,D as r,Na as p,f as n,i,l as u,pa as s,q as h,t as c}from"./chunk-7GXU7I4D.js";var g="/api/usuarios",m=class o{_authStatus=r("checking");_user=r(null);_token=r(localStorage.getItem("token"));http=c(l);checkStatusResource=p({loader:()=>this.checkStatus()});authStatus=s(()=>this._authStatus()==="checking"?"checking":this._user()?"authenticated":"not-authenticated");user=s(()=>this._user());token=s(this._token);login(t,e){return this.http.post(`${g}/login`,{email:t,password:e}).pipe(i(a=>this.handleAuthSuccess(a)),u(a=>this.handleAuthError(a)))}checkStatus(){let t=localStorage.getItem("token");return console.log(t),t?this.http.get(`${g}/verificar`,{}).pipe(i(e=>this.handleAuthSuccess(e)),u(e=>this.handleAuthError(e))):(this.logout(),n(!1))}logout(){this._user.set(null),this._token.set(null),this._authStatus.set("not-authenticated"),localStorage.removeItem("token")}handleAuthSuccess({token:t,user:e}){return this._user.set(e),this._authStatus.set("authenticated"),this._token.set(t),localStorage.setItem("token",t),!0}handleAuthError(t){return this.logout(),n(!1)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"})};export{m as a};
